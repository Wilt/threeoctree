/*!
 *
 * threeoctree.js (r60) / https://github.com/collinhover/threeoctree
 * (sparse) dynamic 3D spatial representation structure for fast searches.
 *
 * @author Collin Hover / http://collinhover.com/
 * based on Dynamic Octree by Piko3D @ http://www.piko3d.com/ and Octree by Marek Pawlowski @ pawlowski.it
 *
 */
(function(g){function q(a){return!isNaN(a)&&isFinite(a)}function n(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}g.Octree=function(a){a=a||{};a.tree=this;this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=q(a.INDEX_OUTSIDE_POS_X)?a.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=q(a.INDEX_OUTSIDE_NEG_X)?a.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=q(a.INDEX_OUTSIDE_POS_Y)?a.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=q(a.INDEX_OUTSIDE_NEG_Y)?
    a.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=q(a.INDEX_OUTSIDE_POS_Z)?a.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=q(a.INDEX_OUTSIDE_NEG_Z)?a.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
    this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
        1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new g.Vector3;this.utilVec32Search=new g.Vector3;if(this.scene=a.scene)this.visualGeometry=new g.CubeGeometry(1,1,1),this.visualMaterial=new g.MeshBasicMaterial({color:16711782,wireframe:!0,wireframeLinewidth:1});this.objects=[];this.objectsMap={};this.objectsData=[];this.objectsDeferred=[];this.depthMax=q(a.depthMax)?a.depthMax:Infinity;this.objectsThreshold=q(a.objectsThreshold)?a.objectsThreshold:8;
    this.overlapPct=q(a.overlapPct)?a.overlapPct:.15;this.undeferred=a.undeferred||!1;this.root=a.root instanceof g.OctreeNode?a.root:new g.OctreeNode(a)};g.Octree.prototype={update:function(){if(0<this.objectsDeferred.length){for(var a=0,b=this.objectsDeferred.length;a<b;a++){var c=this.objectsDeferred[a];this.addDeferred(c.object,c.options)}this.objectsDeferred.length=0}},add:function(a,b){this.undeferred?(this.updateObject(a),this.addDeferred(a,b)):this.objectsDeferred.push({object:a,options:b})},
    addDeferred:function(a,b){var c,d,e;a instanceof g.OctreeObjectData&&(a=a.object);a.uuid||(a.uuid=g.Math.generateUUID());if(!this.objectsMap[a.uuid])if(this.objects.push(a),this.objectsMap[a.uuid]=a,b&&(c=b.useFaces,d=b.useVertices),!0===d)for(c=a.geometry,e=c.vertices,c=0,d=e.length;c<d;c++)this.addObjectData(a,e[c]);else if(!0===c)for(c=a.geometry,e=c.faces,c=0,d=e.length;c<d;c++)this.addObjectData(a,e[c]);else this.addObjectData(a)},addObjectData:function(a,b){var c=new g.OctreeObjectData(a,b);
        this.objectsData.push(c);this.root.addObject(c)},remove:function(a){var b,c=a,d,e;a instanceof g.OctreeObjectData&&(a=a.object);if(this.objectsMap[a.uuid]){if(this.objectsMap[a.uuid]=void 0,d=n(this.objects,a),-1!==d)for(this.objects.splice(d,1),e=this.root.removeObject(c),a=0,b=e.length;a<b;a++)c=e[a],d=n(this.objectsData,c),-1!==d&&this.objectsData.splice(d,1)}else if(0<this.objectsDeferred.length){a:{c=this.objectsDeferred;b=0;for(d=c.length;b<d;b++)if(c[b].object===a){d=b;break a}d=-1}-1!==d&&
    this.objectsDeferred.splice(d,1)}},extend:function(a){var b,c,d;if(a instanceof g.Octree)for(c=a.objectsData,a=0,b=c.length;a<b;a++)d=c[a],this.add(d,{useFaces:d.faces,useVertices:d.vertices})},rebuild:function(){var a,b,c,d,e,m=[];a=0;for(b=this.objectsData.length;a<b;a++)d=this.objectsData[a],c=d.node,d.update(),c instanceof g.OctreeNode&&!d.positionLast.equals(d.position)&&(e=d.indexOctant,c=c.getOctantIndex(d),c!==e&&m.push(d));a=0;for(b=m.length;a<b;a++)d=m[a],d.node.removeObject(d),this.root.addObject(d)},
    updateObject:function(a){var b,c=[a],d,e;for(d=a.parent;d;)c.push(d),d=d.parent;a=0;for(b=c.length;a<b;a++)d=c[a],!0===d.matrixWorldNeedsUpdate&&(e=d);"undefined"!==typeof e&&e.updateMatrixWorld()},search:function(a,b,c,d){var e,m,h,k,l;k=[].concat(this.root.objects);0<b||(b=Number.MAX_VALUE);d instanceof g.Vector3&&(d=this.utilVec31Search.copy(d).normalize(),l=this.utilVec32Search.set(1,1,1).divide(d));e=0;for(m=this.root.nodesIndices.length;e<m;e++)h=this.root.nodesByIndex[this.root.nodesIndices[e]],
        k=h.search(a,b,k,d,l);if(!0===c)for(c=[],d=[],e=0,m=k.length;e<m;e++)a=k[e],b=a.object,h=n(d,b),-1===h?(h={object:b,faces:[],vertices:[]},c.push(h),d.push(b)):h=c[h],a.face?h.faces.push(a.face):a.vertex&&h.vertices.push(a.vertex);else c=k;return c},setRoot:function(a){a instanceof g.OctreeNode&&(this.root=a,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},
    toConsole:function(){this.root.toConsole()},raycast:function(a,b){var c=this.search(a.ray.origin,a.ray.far,!1,a.ray.direction),c=a.intersectObjects(c,!1);Array.prototype.push.apply(b,c)}};g.OctreeObjectData=function(a,b){this.object=a;switch(!0){case b instanceof g.Face3:this.face=b;break;case b instanceof g.Vector3:this.vertex=b}this.radius=0;this.position=new g.Vector3;this.object instanceof g.Object3D?this.update():(this.position.set(a.x,a.y,a.z),this.radius=a.radius);this.positionLast=this.position.clone()};
    g.OctreeObjectData.prototype={update:function(){this.face?(this.computeFaceCentroid(),this.computeFaceBoundingRadius(),this.position.copy(this.centroid)):this.vertex?(this.computeVertexBoundingRadius(),this.position.copy(this.vertex)):(this.computeBoundingRadius(),this.position.copy(this.object.geometry.boundingSphere.center));this.object.localToWorld(this.position)},computeFaceCentroid:function(){var a=(this.object.geometry||this.object).vertices,b=this.face;this.centroid=new g.Vector3;this.centroid.add(a[b.a]);
        this.centroid.add(a[b.b]);this.centroid.add(a[b.c]);this.centroid.divideScalar(3)},computeFaceBoundingRadius:function(){var a=new g.Vector3;return function(){var b=(this.object.geometry||this.object).vertices,c=this.face,d=this.centroid,e=b[c.a],g=b[c.b],b=b[c.c];d.addVectors(e,g).add(b).divideScalar(3);this.radius=Math.max(a.subVectors(d,e).length(),a.subVectors(d,g).length(),a.subVectors(d,b).length());this.radius*=Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)}}(),computeVertexBoundingRadius:function(){var a=
        new g.Sphere;return function(){var b=this.object.geometry||this.object;this.object.isPoints?this.radius=this.object.material.size:(a.setFromPoints(b.vertices,this.vertex),this.radius=a.radius);this.radius*=Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)}}(),computeBoundingRadius:function(){var a=this.object.geometry||this.object;a&&(null===a.boundingSphere&&a.computeBoundingSphere(),this.radius=a.boundingSphere.radius,this.radius*=Math.max(this.object.scale.x,this.object.scale.y,
        this.object.scale.z))},raycast:function(a,b){var c=new g.Matrix4,d=new g.Ray,e=new g.Sphere,m=new g.Vector3,h=new g.Vector3,k=new g.Vector3,l=new g.Vector3,u=new g.Vector3,p=new g.Vector3;new g.Vector2;new g.Vector2;new g.Vector2;new g.Vector3;var q=new g.Vector3,B=new g.Vector3;return function(a,b){var t=this.object,r=t.geometry,w=r.vertices,x=t.material,v=t.matrixWorld;if(void 0!==x&&(null===r.boundingSphere&&r.computeBoundingSphere(),e.copy(r.boundingSphere),e.applyMatrix4(v),!1!==a.ray.intersectsSphere(e)&&
        (c.getInverse(v),d.copy(a.ray).applyMatrix4(c),null===r.boundingBox||!1!==d.intersectsBox(r.boundingBox))))if(this.face){var n=x instanceof g.MultiMaterial,D=!0===n?x.materials:null,v=this.face,F=r.faces.indexOf(v),A=w[v.a],y=w[v.b],w=w[v.c],x=!0===n?D[v.materialIndex]:x;if(void 0!==x){if(!0===x.morphTargets){r=r.morphTargets;x=this.morphTargetInfluences;m.set(0,0,0);h.set(0,0,0);k.set(0,0,0);n=0;for(D=r.length;n<D;n++){var C=x[n];if(0!==C){var E=r[n].vertices;m.addScaledVector(l.subVectors(E[v.a],
        A),C);h.addScaledVector(u.subVectors(E[v.b],y),C);k.addScaledVector(p.subVectors(E[v.c],w),C)}}m.add(A);h.add(y);k.add(w);A=m;y=h;w=k}r=t.material;null===(r.side===g.BackSide?d.intersectTriangle(w,y,A,!0,q):d.intersectTriangle(A,y,w,r.side!==g.DoubleSide,q))?t=null:(B.copy(q),B.applyMatrix4(t.matrixWorld),y=a.ray.origin.distanceTo(B),t=y<a.near||y>a.far?null:{distance:y,point:B.clone(),object:t});t&&(t.face=v,t.faceIndex=F,b.push(t))}}else t.raycast(a,b)}}()};g.OctreeNode=function(a){this.utilVec31Branch=
        new g.Vector3;this.utilVec31Expand=new g.Vector3;this.utilVec31Ray=new g.Vector3;a=a||{};a.tree instanceof g.Octree?this.tree=a.tree:!0!==a.parent instanceof g.OctreeNode&&(a.root=this,this.tree=new g.Octree(a));this.id=this.tree.nodeCount++;this.position=a.position instanceof g.Vector3?a.position:new g.Vector3;this.radius=0<a.radius?a.radius:1;this.indexOctant=a.indexOctant;this.depth=0;this.reset();this.setParent(a.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+
        this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+this.radiusOverlap;this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new g.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),
        this.tree.scene.add(this.visual))};g.OctreeNode.prototype={setParent:function(a){a!==this&&this.parent!==a&&(this.parent=a,this.updateProperties())},updateProperties:function(){var a,b;this.parent instanceof g.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;a=0;for(b=this.nodesIndices.length;a<b;a++)this.nodesByIndex[this.nodesIndices[a]].updateProperties()},reset:function(a,b){var c,d,e,g=this.nodesIndices||[],h=this.nodesByIndex;this.objects=[];this.nodesIndices=
        [];this.nodesByIndex={};c=0;for(d=g.length;c<d;c++)e=h[g[c]],e.setParent(void 0),!0===a&&e.reset(a,b);!0===b&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(a,b){a.indexOctant=b;-1===n(this.nodesIndices,b)&&this.nodesIndices.push(b);this.nodesByIndex[b]=a;a.parent!==this&&a.setParent(this)},removeNode:function(a){var b,c;b=n(this.nodesIndices,a);this.nodesIndices.splice(b,1);c=c||this.nodesByIndex[a];delete this.nodesByIndex[a];c.parent===this&&c.setParent(void 0)},
        addObject:function(a){var b;b=this.getOctantIndex(a);-1<b&&0<this.nodesIndices.length?(b=this.branch(b),b.addObject(a)):-1>b&&this.parent instanceof g.OctreeNode?this.parent.addObject(a):(b=n(this.objects,a),-1===b&&this.objects.push(a),a.node=this,this.checkGrow())},addObjectWithoutCheck:function(a){var b,c,d;b=0;for(c=a.length;b<c;b++)d=a[b],this.objects.push(d),d.node=this},removeObject:function(a){var b,c,d;d=this.removeObjectRecursive(a,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]});
            c=d.nodesRemovedFrom;if(0<c.length)for(a=0,b=c.length;a<b;a++)c[a].shrink();return d.objectsDataRemoved},removeObjectRecursive:function(a,b){var c,d,e;if(a instanceof g.OctreeObjectData)c=n(this.objects,a),-1!==c&&(this.objects.splice(c,1),a.node=void 0,b.objectsDataRemoved.push(a),b.searchComplete=d=!0);else for(c=this.objects.length-1;0<=c;c--)if(e=this.objects[c],e.object===a&&(this.objects.splice(c,1),e.node=void 0,b.objectsDataRemoved.push(e),d=!0,!e.faces&&!e.vertices)){b.searchComplete=!0;
            break}!0===d&&b.nodesRemovedFrom.push(this);if(!0!==b.searchComplete)for(c=0,d=this.nodesIndices.length;c<d&&(e=this.nodesByIndex[this.nodesIndices[c]],b=e.removeObjectRecursive(a,b),!0!==b.searchComplete);c++);return b},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var a,b,c=[],d=[],e=[],g=[],h=[],k,l;k=0;for(l=this.objects.length;k<l;k++)b=this.objects[k],a=this.getOctantIndex(b),-1<a?(e.push(b),g.push(a)):-1>a?(c.push(b),
            d.push(a)):h.push(b);0<e.length&&(h=h.concat(this.split(e,g)));0<c.length&&(h=h.concat(this.expand(c,d)));this.objects=h;this.checkMerge()},split:function(a,b){var c,d,e,g,h;if(this.depth<this.tree.depthMax){a=a||this.objects;b=b||[];h=[];c=0;for(d=a.length;c<d;c++)g=a[c],e=b[c],-1<e?(e=this.branch(e),e.addObject(g)):h.push(g);a===this.objects&&(this.objects=h)}else h=this.objects;return h},branch:function(a){var b,c;this.nodesByIndex[a]instanceof g.OctreeNode?b=this.nodesByIndex[a]:(b=.5*this.radiusOverlap,
            c=b*this.tree.overlapPct,c=b-c,c=this.utilVec31Branch.set(a&1?c:-c,a&2?c:-c,a&4?c:-c),c=(new g.Vector3).addVectors(this.position,c),b=new g.OctreeNode({tree:this.tree,parent:this,position:c,radius:b,indexOctant:a}),this.addNode(b,a));return b},expand:function(a,b){var c,d,e,m,h,k,l=this.tree.INDEX_OUTSIDE_MAP,u,p,n,q,z=this.utilVec31Expand;if(this.tree.root.getDepthEnd()<this.tree.depthMax){a=a||this.objects;b=b||[];m=[];h=[];c=0;for(d=l.length;c<d;c++)l[c].count=0;c=0;for(d=a.length;c<d;c++)e=a[c],
            k=b[c],-1>k?(k=-k-this.tree.INDEX_OUTSIDE_OFFSET,k&this.tree.FLAG_POS_X?l[this.tree.INDEX_OUTSIDE_POS_X].count++:k&this.tree.FLAG_NEG_X&&l[this.tree.INDEX_OUTSIDE_NEG_X].count++,k&this.tree.FLAG_POS_Y?l[this.tree.INDEX_OUTSIDE_POS_Y].count++:k&this.tree.FLAG_NEG_Y&&l[this.tree.INDEX_OUTSIDE_NEG_Y].count++,k&this.tree.FLAG_POS_Z?l[this.tree.INDEX_OUTSIDE_POS_Z].count++:k&this.tree.FLAG_NEG_Z&&l[this.tree.INDEX_OUTSIDE_NEG_Z].count++,h.push(e)):m.push(e);if(0<h.length)for(u=l.slice(0),u.sort(function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    b){return b.count-a.count}),k=u[0],d=k.index|1,l=u[1],p=u[2],c=(l.index|1)!==d?l:p,e=c.index|1,l=u[2],p=u[3],u=u[4],n=l.index|1,q=p.index|1,l=n!==d&&n!==e?l:q!==d&&q!==e?p:u,d=k.x+c.x+l.x,e=k.y+c.y+l.y,c=k.z+c.z+l.z,k=this.getOctantIndexFromPosition(d,e,c),c=this.getOctantIndexFromPosition(-d,-e,-c),e=this.overlap,l=this.radius,d=0<this.tree.overlapPct?e/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*l,p=d*this.tree.overlapPct,e=d+p-(l+e),z.set(k&1?e:-e,k&2?e:-e,k&4?e:-e),z=(new g.Vector3).addVectors(this.position,
            z),z=new g.OctreeNode({tree:this.tree,position:z,radius:d}),z.addNode(this,c),this.tree.setRoot(z),c=0,d=h.length;c<d;c++)this.tree.root.addObject(h[c]);a===this.objects&&(this.objects=m)}else m=a;return m},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var a=this,b;a.parent instanceof g.OctreeNode&&a.getObjectCountEnd()<this.tree.objectsThreshold;)b=a,a=a.parent;a!==this&&a.merge(b)},merge:function(a){var b,c,d;a=a?"[object Array]"===Object.prototype.toString.call(a)!==
        !0?[a]:a:[];b=0;for(c=a.length;b<c;b++)d=a[b],this.addObjectWithoutCheck(d.getObjectsEnd()),d.reset(!0,!0),this.removeNode(d.indexOctant,d);this.checkMerge()},checkContract:function(){var a,b,c,d,e,m,h;if(0<this.nodesIndices.length){m=0;h=this.objects.length;a=0;for(b=this.nodesIndices.length;a<b;a++)if(c=this.nodesByIndex[this.nodesIndices[a]],d=c.getObjectCountEnd(),h+=d,!1===e instanceof g.OctreeNode||d>m)e=c,m=d;h-m<this.tree.objectsThreshold&&e instanceof g.OctreeNode&&this.contract(e)}},contract:function(a){var b,
            c,d;b=0;for(c=this.nodesIndices.length;b<c;b++)d=this.nodesByIndex[this.nodesIndices[b]],d!==a&&(a.addObjectWithoutCheck(d.getObjectsEnd()),d.reset(!0,!0));a.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(a);a.checkContract()},getOctantIndex:function(a){var b,c,d=this.position,e=this.radiusOverlap,m=this.overlap,h,k,l,n,p=0;a instanceof g.OctreeObjectData?(c=a.radius,b=a.position,a.positionLast.copy(b)):a instanceof g.OctreeNode&&(b=a.position,c=0);h=b.x-d.x;k=b.y-d.y;b=b.z-
            d.z;d=Math.abs(h);l=Math.abs(k);n=Math.abs(b);if(Math.max(d,l,n)+c>e)return d+c>e&&(p^=0<h?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+c>e&&(p^=0<k?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),n+c>e&&(p^=0<b?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),a.indexOctant=-p-this.tree.INDEX_OUTSIDE_OFFSET,a.indexOctant;if(h-c>-m)p|=1;else if(!(h+c<m))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;if(k-c>-m)p|=2;else if(!(k+c<m))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;
            if(b-c>-m)p|=4;else if(!(b+c<m))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;a.indexOctant=p;return a.indexOctant},getOctantIndexFromPosition:function(a,b,c){var d=0;0<a&&(d|=1);0<b&&(d|=2);0<c&&(d|=4);return d},search:function(a,b,c,d,e){var g,h;if(!0===(d?this.intersectRay(a,d,b,e):this.intersectSphere(a,b)))for(c=c.concat(this.objects),e=0,g=this.nodesIndices.length;e<g;e++)h=this.nodesByIndex[this.nodesIndices[e]],c=h.search(a,b,c,d);return c},intersectSphere:function(a,b){var c=
            b*b,d=a.x,e=a.y,g=a.z;d<this.left?c-=Math.pow(d-this.left,2):d>this.right&&(c-=Math.pow(d-this.right,2));e<this.bottom?c-=Math.pow(e-this.bottom,2):e>this.top&&(c-=Math.pow(e-this.top,2));g<this.back?c-=Math.pow(g-this.back,2):g>this.front&&(c-=Math.pow(g-this.front,2));return 0<=c},intersectRay:function(a,b,c,d){"undefined"===typeof d&&(d=this.utilVec31Ray.set(1,1,1).divide(b));b=(this.left-a.x)*d.x;var e=(this.right-a.x)*d.x,g=(this.bottom-a.y)*d.y,h=(this.top-a.y)*d.y,k=(this.back-a.z)*d.z;d=(this.front-
            a.z)*d.z;a=Math.min(Math.min(Math.max(b,e),Math.max(g,h)),Math.max(k,d));if(0>a)return!1;b=Math.max(Math.max(Math.min(b,e),Math.min(g,h)),Math.min(k,d));return!(b>a||b>c)},getDepthEnd:function(a){var b,c,d;if(0<this.nodesIndices.length)for(b=0,c=this.nodesIndices.length;b<c;b++)d=this.nodesByIndex[this.nodesIndices[b]],a=d.getDepthEnd(a);else a=!a||this.depth>a?this.depth:a;return a},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var a,
            b,c=this.nodesIndices.length;a=0;for(b=this.nodesIndices.length;a<b;a++)c+=this.nodesByIndex[this.nodesIndices[a]].getNodeCountRecursive();return c},getObjectsEnd:function(a){var b,c,d;a=(a||[]).concat(this.objects);b=0;for(c=this.nodesIndices.length;b<c;b++)d=this.nodesByIndex[this.nodesIndices[b]],a=d.getObjectsEnd(a);return a},getObjectCountEnd:function(){var a,b,c=this.objects.length;a=0;for(b=this.nodesIndices.length;a<b;a++)c+=this.nodesByIndex[this.nodesIndices[a]].getObjectCountEnd();return c},
        getObjectCountStart:function(){for(var a=this.objects.length,b=this.parent;b instanceof g.OctreeNode;)a+=b.objects.length,b=b.parent;return a},toConsole:function(a){var b,c,d;a="string"===typeof a?a:"   ";console.log(this.parent?a+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?a+" ":" ","+ objects ( ",this.objects.length,
            " ) ",this.objects);console.log(this.parent?a+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);b=0;for(c=this.nodesIndices.length;b<c;b++)d=this.nodesByIndex[this.nodesIndices[b]],d.toConsole(a+"   ")}}})(THREE);